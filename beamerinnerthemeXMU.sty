\pgfdeclareverticalshading[lower.bg,upper.bg]{bmb@transition}{200cm}{%
  color(0pt)=(lower.bg); color(2pt)=(lower.bg); color(4pt)=(lower.bg)}

\setbeamersize{text margin left=2em,text margin right=2em} 

% table of contents (overview)
\setbeamertemplate{section in toc}[sections numbered]
\setbeamertemplate{subsection in toc}{\leavevmode\leftskip=3.2em\rlap{\hskip-2em\inserttocsectionnumber.\inserttocsubsectionnumber}\inserttocsubsection\par}
\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{blocks}[default]
\setbeamertemplate{enumerate items}[default]
\setbeamertemplate{date}[default]

% General frames
\setbeamertemplate{frametitle}{
    \vspace*{0.5em}
    \insertframetitle
    \hfill
    \logo { 
        \begin{tikzpicture}[overlay,remember picture]
            \node[left=2em,below=0.7em] at (current page.north east){
        % \begin{tikzpicture}[overlay,remember picture]
        %     \node[anchor=north east, outer xsep=15pt, outer ysep=15pt] at (current page.north east){
                \includegraphics[width=4em]{xmulogo/xmu-zi-jiageng blue.pdf}
            };
        \end{tikzpicture}
    }
    %-------------------------
    {\usebeamercolor[fg]{titlegraphic}\insertlogo\par}
    \par
    \vskip0.5em
}

% Footline
\setbeamertemplate{footline}{%
  \begin{beamercolorbox}[ht=3em,sep=0.75em,wd=\paperwidth,leftskip=0.5cm,rightskip=0.5cm]{footlinecolor}
    \scriptsize{\insertshortinstitute}
    \hspace{1cm}
    \hfill
    \scriptsize{\insertframenumber/\inserttotalframenumber}
  \end{beamercolorbox}%
}

% Template for headings in multicolumn layout
\setbeamertemplate{column_heading}{
    \begin{beamercolorbox}[sep=8pt,left]{column heading}
        \usebeamerfont{title}
    \end{beamercolorbox}
}

% Template for the final page of the presentation
\setbeamertemplate{endpage}{
    \vspace{8em}
    \begingroup
        \centering
        % ------------------------
        \begin{beamercolorbox}[sep=8pt,left]{title}
        \setbeamercolor{normal text}{fg=red}
        \vskip2.5em\par
        \usebeamerfont{title}\finalpage \par% 
        \end{beamercolorbox}%
        \vskip 2.5em\par
        % ------------------------
        \begin{beamercolorbox}[sep=8pt,left]{author}
        \usebeamerfont{author}\insertauthor
        \end{beamercolorbox}
        \vskip-2em
        % ------------------------
        \vskip1.5em\par
        \begin{beamercolorbox}[sep=8pt,left]{institute}
        \usebeamerfont{institute}\insertinstitute
        \hspace*{0.25\linewidth}
        \usebeamerfont{date}\insertdate
        \end{beamercolorbox}
        % ------------------------

        % Logo on the end page
       \titlegraphic{
        \begin{tikzpicture}[overlay,remember picture]
        \node[anchor=north west, outer xsep=25pt, outer ysep=25pt] at (current page.north west){
            \includegraphics[width=5cm]{xmulogo/xmu-zi-jiageng white.pdf}
        };
        \end{tikzpicture}
        }
      
       {\usebeamercolor[fg]{titlegraphic}\inserttitlegraphic\par}
    \endgroup
    \vfill
}

% Title page
\setbeamertemplate{title page}{
    \vspace{8em}
    \begingroup
        \centering
        % ------------------------
        \begin{beamercolorbox}[sep=8pt,left]{title}
            \usebeamerfont{title}\inserttitle\par%
            \ifx\insertsubtitle\@empty%
            \else%
                \vskip0.25em%
                {\usebeamerfont{subtitle}\usebeamercolor[fg]{subtitle}\insertsubtitle\par}%
            \fi%
        \end{beamercolorbox}%
        \vskip4em\par
        % ------------------------
        \begin{beamercolorbox}[sep=8pt,left]{author}
            \usebeamerfont{author}\insertauthor
        \end{beamercolorbox}
        \vskip-2em
        % ------------------------
        \vskip1.5em\par
        \begin{beamercolorbox}[sep=8pt,left]{institute}
            \usebeamerfont{institute}\insertinstitute
            \hspace*{0.25\linewidth}
            \usebeamerfont{date}\insertdate
        \end{beamercolorbox}
    
        % Logo on the title page
       \titlegraphic{
    \begin{tikzpicture}[overlay,remember picture]
        \node[anchor=north west, outer xsep=25pt, outer ysep=25pt] at (current page.north west){
            % 首页左上角logo
            \includegraphics[width=5cm]{xmulogo/xmu-zi-jiageng white.pdf}
        };
    \end{tikzpicture}
        } 
       {\usebeamercolor[fg]{titlegraphic}\inserttitlegraphic\par}
    \endgroup
    \vfill
}

% Section divider
\setbeamertemplate{section divider}{
\logo { 
    \begin{tikzpicture}[overlay,remember picture]
    \node[anchor=north west, outer xsep=25pt, outer ysep=20pt] at (current page.north west){
        \includegraphics[width=4cm]{xmulogo/xmu-zi-jiageng white.pdf}
    };
    \end{tikzpicture}
    }
    \vspace{12em}
    \begin{beamercolorbox}[sep=0pt,left]{sectionDivider}
        \usebeamerfont{frametitle}
        \insertsectionhead\par%
    \end{beamercolorbox}%
    \gradientline\par
    \vspace{9em}
    \begin{beamercolorbox}[ht=1em,sep=8pt,wd=\paperwidth,leftskip=0.5cm,rightskip=0.5cm]{footlinecolor}
        \hspace{5pt}
        \small{\insertshortinstitute}
        \hfill
    \end{beamercolorbox}%
    %-------------------------
    {\usebeamercolor[fg]{titlegraphic}\insertlogo\par}
    
}


%Select the Epilogue font (requires luaLatex or XeLaTex compilers)
% \setsansfont{Epilogue}[
%     Path=./AICStyleData/epilogueFont/,
%     Scale=0.9,
%     Extension = .ttf,
%     UprightFont=*-Regular,
%     BoldFont=*-Bold,
%     ItalicFont=*-Italic,
%     BoldItalicFont=*-BoldItalic
%     ]


%----------------------------------------------------------------------------------------
%	Custom commands
%----------------------------------------------------------------------------------------
% Section divider
% gradient color line for the section separation
\newcommand{\gradientline}{\noindent%
    \begin{tikzpicture}
     \node [rectangle, left color=PrussianBlue, right color=Solitude, middle color=PrussianBlue, anchor=north, minimum width=0.8\linewidth, inner sep=0pt, minimum height=1.5pt] (box) at (current page.north){};
    \end{tikzpicture}
}

\newcommand \makesection[1]{
{
\usebackgroundtemplate{
\includegraphics[width=\paperwidth]{xmulogo/section bg.pdf}
}
\begin{frame}[plain, noframenumbering]
    \section{#1}
    \usebeamertemplate{section divider}
\end{frame}
}
}
% ----------------------------------------------------------

% command for building the last slide of the presentation
\newcommand\finalpage{}  % Empty by default.
\newcommand\finalpagetext[1]{\renewcommand\finalpage{#1}}

\newcommand \makefinalpage{
   {
    \usebackgroundtemplate{
    \includegraphics[width=\paperwidth]{xmulogo/section bg.pdf}
    }
    \begin{frame}[plain]
    \usebeamertemplate{endpage}
    \end{frame}
    }
}
% ----------------------------------------------------------

% command for building the first slide of the presentation
\newcommand \maketitlepage{
    {
    \usebackgroundtemplate{
    \includegraphics[width=\paperwidth]{xmulogo/section bg.pdf}
    }
\begin{frame}[plain]
    % Print the title page as the first slide
    \titlepage
\end{frame}
}
}
% ----------------------------------------------------------

% Formatting for header columns in multi-column page
\newcommand\colheader[1]{\textcolor{PrussianBlue}{\textbf{#1}}\par}
% ----------------------------------------------------------
